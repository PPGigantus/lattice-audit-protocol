services:
  gateway:
    build:
      context: ..
      dockerfile: demo/Dockerfile.gateway
    container_name: lap-demo-gateway
    ports:
      - "8000:8000"
    environment:
      # Demo signing key (NOT secure for production)
      - LAP_GATEWAY_SIGNING_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

      # Enable API-key auth (recommended)
      - LAP_API_KEYS_JSON={"dev-key-1":"agent_001"}

      # Register HTTP tool connector
      - LAP_HTTP_TOOL_URL=http://lap-tool:9000
      - LAP_HTTP_TOOL_API_KEY=demo-tool-key

      # Keep protocol engine off by default for backwards compatible behavior
      # - LAP_ENABLE_PROTOCOL_ENGINE=1
    depends_on:
      - tool
    networks:
      - gateway_net
      - tool_net

  tool:
    build:
      context: ./tool
      dockerfile: Dockerfile
    container_name: lap-tool
    environment:
      - TOOL_API_KEY=demo-tool-key
    networks:
      - tool_net

  agent:
    image: curlimages/curl:8.5.0
    container_name: lap-demo-agent
    command: ["sh", "-c", "sleep 365d"]
    networks:
      - gateway_net

networks:
  gateway_net:
    driver: bridge
  tool_net:
    driver: bridge
